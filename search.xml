<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>åœ¨ Ubuntu ä¸Šä½¿ç”¨ Shadowsocks æ­å»ºä¸ªäºº VPN æœåŠ¡å™¨</title>
    <url>/Tools/Shadowsocks/shadowsocks/</url>
    <content><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>æ‹¥æœ‰ä¸€å°æµ·å¤–äº‘æœåŠ¡å™¨èƒ½åšä»€ä¹ˆï¼Ÿ</p>
<p>èƒ½æ­å»ºä¸ªäººä¸“å±çš„ VPN æœåŠ¡å™¨</p>
<p>æ­å»º VPN æœåŠ¡å™¨èƒ½åšä»€ä¹ˆï¼Ÿ</p>
<p>èƒ½ã€‚ã€‚ã€‚ã€‚çˆ±æ­ä¸æ­</p>
<a id="more"></a>

<h1 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h1><ul>
<li>ä¸€å°è£…æœ‰Ubuntuç³»ç»Ÿä¸”æ‹¥æœ‰æµ·å¤–å…¬ç½‘ IP çš„äº‘æœåŠ¡å™¨</li>
</ul>
<h1 id="å®‰è£…-Shadowsocks-æœåŠ¡ç«¯"><a href="#å®‰è£…-Shadowsocks-æœåŠ¡ç«¯" class="headerlink" title="å®‰è£… Shadowsocks æœåŠ¡ç«¯"></a>å®‰è£… Shadowsocks æœåŠ¡ç«¯</h1><p>é¦–å…ˆé€šè¿‡ SSH è¿æ¥ä½ çš„äº‘æœåŠ¡å™¨ï¼Œå¦‚ä½•è¿æ¥æœåŠ¡å™¨ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œè¿™é‡Œä¸äºˆä»¥èµ˜è¿°</p>
<p>å¦‚æœæœåŠ¡å™¨çš„ç³»ç»Ÿæ˜¯æ–°è£…çš„ï¼Œå»ºè®®å…ˆæ›´æ–°ä¸€ä¸‹æº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get update &amp; apt-get upgrade</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°å®Œæˆåï¼Œå®‰è£… pip</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install python-pip</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ pip å®‰è£… Shadowsocks æœåŠ¡ç«¯ç¨‹åº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®-Shadowsocks-æœåŠ¡å™¨"><a href="#é…ç½®-Shadowsocks-æœåŠ¡å™¨" class="headerlink" title="é…ç½® Shadowsocks æœåŠ¡å™¨"></a>é…ç½® Shadowsocks æœåŠ¡å™¨</h1><p>æŒ‰ç…§ä¸Šæ–‡å®‰è£… Shadowsocks å®Œæˆåï¼Œæˆ‘ä»¬ç›´æ¥å¯ä»¥é€šè¿‡å‘½ä»¤çš„æ–¹å¼å¯åŠ¨ Shadowsocks æœåŠ¡ï¼Œä½†ç¬”è€…æ¨èåˆ©ç”¨è¯»å–é…ç½®æ–‡ä»¶çš„æ–¹å¼æ¥å¯åŠ¨ï¼Œæ‰€ä»¥å°±ä¸ä»‹ç»å‘½ä»¤è¡Œå¯åŠ¨çš„æ–¹å¼äº†</p>
<p>åœ¨ç™»å½•ç”¨æˆ·çš„ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">mkdir shadowsocks</span><br><span class="line">vim shadowsocks/config.json</span><br></pre></td></tr></table></figure>

<p>é”®å…¥ä»¥ä¸‹å†…å®¹ï¼ˆåˆ«å¿˜è®°æŠŠå¸¦æœ‰$çš„å˜é‡æ›¿æ¢æˆä½ è‡ªå·±çš„ä¿¡æ¯ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>: <span class="string">"8388"</span>,</span><br><span class="line">    <span class="attr">"local_address"</span>: <span class="string">"127.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>: <span class="string">"1080"</span>,</span><br><span class="line">    <span class="attr">"port_password"</span>: &#123;</span><br><span class="line">        <span class="attr">"8387"</span>: <span class="string">"$your_password"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"timeout"</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">"method"</span>: <span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="attr">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>server</code>ç›´æ¥ <code>0.0.0.0</code> æŒ‡å‘å½“å‰æœºå™¨</p>
<p><code>server_port</code> æœåŠ¡ç«¯ç«¯å£</p>
<p><code>local_address</code> æ˜¯æœ¬åœ°ä»£ç†çš„åœ°å€</p>
<p><code>local_port</code> æœ¬åœ°ä»£ç†çš„ç«¯å£</p>
<p><code>port_password</code> æ˜¯åˆ›å»ºå®¢æˆ·ç«¯ç«¯å£å·ï¼›key ï¼ˆå¦‚ â€œ8387â€ï¼‰ æ˜¯ç«¯å£å·ï¼Œvalue æ˜¯è¯¥ç«¯å£å·å¯¹åº”çš„è¿æ¥å¯†ç ï¼Œè¿™é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªè´¦å·ï¼Œä¾›å¤šä¸ªç”¨æˆ·è¿æ¥</p>
<p><code>timeout</code> è¶…æ—¶æ—¶é—´</p>
<p><code>method</code> åŠ å¯†æ–¹å¼</p>
<p><code>fast_open</code> æ˜¯å¦ä½¿ç”¨ TCP è¿æ¥</p>
<h1 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h1><p>å®Œæˆé…ç½®æ–‡ä»¶çš„ç¼–å†™åï¼Œæˆ‘ä»¬å°±æ¥å¯åŠ¨å®ƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssserver â€c ~/shadowsocks/config.json â€d start</span><br></pre></td></tr></table></figure>

<h1 id="éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸå¼€å¯"><a href="#éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸå¼€å¯" class="headerlink" title="éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸå¼€å¯"></a>éªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸå¼€å¯</h1><p>æˆ‘ä»¬é¦–å…ˆé€šè¿‡æŸ¥çœ‹ shadowsocks çš„æ—¥å¿—æ–‡ä»¶æ¥éªŒè¯æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /var/<span class="built_in">log</span>/shadowsocks.log</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œä½ å°†åªçœ‹åˆ°è¿™æ ·ä¸€å¥æ—¥å¿—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO     starting server at xxx.xx.xxx.xxx:8387</span><br></pre></td></tr></table></figure>

<p>è¿™è¯´æ˜ä½ çš„æœåŠ¡å¯åŠ¨æˆåŠŸäº†</p>
<p>å¦‚æœçœ‹åˆ°ä»¥ä¸‹åŒ…å«ä»¥ä¸‹å­—æ ·çš„æŠ¥é”™æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">undefined symbol: EVP_CIPHER_CTX_cleanup</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºåœ¨ openssl 1.1.0 ç‰ˆæœ¬ä¸­ï¼ŒåºŸå¼ƒäº† EVP_CIPHER_CTX_cleanup å‡½æ•°ï¼Œå¦‚å®˜ç½‘ä¸­æ‰€è¯´ï¼š</p>
<blockquote>
<p>EVP_CIPHER_CTX was made opaque in OpenSSL 1.1.0. As a result, EVP_CIPHER_CTX_reset() appeared and EVP_CIPHER_CTX_cleanup() disappeared.  </p>
</blockquote>
<blockquote>
<p>EVP_CIPHER_CTX_init() remains as an alias for EVP_CIPHER_CTX_reset(). </p>
</blockquote>
<p>è§£å†³é—®é¢˜çš„åŠæ³•å°±æ˜¯ï¼š</p>
<ol>
<li>ç”¨ vim æ‰“å¼€æ–‡ä»¶ï¼švim /usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py (è¯¥è·¯å¾„è¯·æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿæƒ…å†µè‡ªè¡Œä¿®æ”¹ï¼Œå¦‚æœä¸çŸ¥é“è¯¥æ–‡ä»¶åœ¨å“ªé‡Œçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾æ–‡ä»¶ä½ç½®)</li>
<li>æœç´¢cleanupï¼Œå…±æœ‰ä¸¤å¤„</li>
<li>å°†ç¬¬ä¸€å¤„ï¼ˆ2.8.2ç‰ˆæœ¬åœ¨52è¡Œï¼‰libcrypto.EVP_CIPHER_CTX_cleanup.argtypes = (c_void_p,) æ”¹ä¸ºlibcrypto.EVP_CIPHER_CTX_reset.argtypes = (c_void_p,)</li>
<li>å°†ç¬¬äºŒå¤„ï¼ˆ2.8.2ç‰ˆæœ¬åœ¨111è¡Œï¼‰libcrypto.EVP_CIPHER_CTX_cleanup(self._ctx)<br>æ”¹ä¸ºlibcrypto.EVP_CIPHER_CTX_reset(self._ctx)</li>
<li>ä¿å­˜å¹¶é€€å‡º</li>
<li>é‡æ–°æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶éªŒè¯æ˜¯å¦å¯åŠ¨æˆåŠŸ</li>
</ol>
<h1 id="å®¢æˆ·ç«¯è¿æ¥"><a href="#å®¢æˆ·ç«¯è¿æ¥" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥"></a>å®¢æˆ·ç«¯è¿æ¥</h1><p>å®Œæˆ Shadowsocks çš„æœåŠ¡ç«¯éƒ¨ç½²åï¼Œå°è¯•ä¸€ä¸‹å®¢æˆ·ç«¯è¿æ¥</p>
<h2 id="ä¸‹è½½å®¢æˆ·ç«¯ç¨‹åº-Outline"><a href="#ä¸‹è½½å®¢æˆ·ç«¯ç¨‹åº-Outline" class="headerlink" title="ä¸‹è½½å®¢æˆ·ç«¯ç¨‹åº Outline"></a>ä¸‹è½½å®¢æˆ·ç«¯ç¨‹åº Outline</h2><p>ä¸‹è½½åœ°å€ï¼š[<a href="https://getoutline.org/zh-CN/home]" target="_blank" rel="noopener">https://getoutline.org/zh-CN/home]</a></p>
<p>Outline åŒæ—¶æ”¯æŒ Androidã€IOSã€macOSã€Windowsã€Chrome OSã€Linux å…­å¤§ç»ˆç«¯å¹³å°ï¼Œæœ¬æ–‡ä»¥ IOS ä¸ºä¾‹ï¼ŒApp Store å¯ä»¥ç›´æ¥æœç´¢åˆ° Outline ä¸‹è½½</p>
<p>ç„¶åæˆ‘ä»¬è½¬åˆ° Shadowsocks å®˜ç½‘æ•™ç¨‹ï¼š[<a href="https://shadowsocks.org/en/config/quick-guide.html]" target="_blank" rel="noopener">https://shadowsocks.org/en/config/quick-guide.html]</a></p>
<p>æ ¹æ®æˆ‘ä»¬åˆšæ‰çš„é…ç½®ç”Ÿæˆä¸€ä¸ªå¯ä»¥ä¾› Outline è¯†åˆ«çš„é“¾æ¥</p>
<ol>
<li><p>æ‰¾åˆ° Try it yourself ä¸€æ ï¼Œåœ¨ Plain ä¸€è¡Œè¾“å…¥ ss://aes-256-cfb:$your_password@xxx.xx.xxx.xxx:8387</p>
<p><code>ss://</code> è¡¨ç¤ºä½¿ç”¨ Shadowsocks åè®®</p>
<p><code>aes-256-cfb</code> è¡¨ç¤ºåŠ å¯†æ–¹å¼</p>
<p><code>$your_password</code> 8387 ç«¯å£å¯¹åº”çš„å¯†ç </p>
<p><code>xxx.xx.xxx.xxx</code> ä½ æœåŠ¡å™¨çš„å…¬ç½‘ IP</p>
<p><code>8387</code> æœåŠ¡ç«¯é…ç½®çš„ç«¯å£</p>
</li>
<li><p>æ‹·è´ Encoded ä¸‹è‡ªåŠ¨ç”Ÿæˆçš„é“¾æ¥åˆ°ä½ çš„æ‰‹æœº</p>
</li>
</ol>
<p>æ‰“å¼€ Outline - æ·»åŠ æœåŠ¡å™¨ - è¾“å…¥åˆšæ‰æ‹·è´çš„é“¾æ¥ - æ·»åŠ å®Œæˆåç‚¹å‡»è¿æ¥</p>
<p>Outline Logo å˜æˆç»¿è‰²åè¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æŸ¥çœ‹è‡ªå·±æ‰‹æœºçš„ IP æ˜¯å¦å˜æˆä½ æœåŠ¡å™¨çš„å…¬ç½‘ IP æ¥åšæœ€åä¸€æ¬¡éªŒè¯æœ¬æ¬¡ VPN æ˜¯å¦æ­å»ºæˆåŠŸï¼ŒæŸ¥çœ‹æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œä¸å†èµ˜è¿°</p>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>åœ¨å¢™å¤–æ”¾é£è‡ªæˆ‘å§ï¼ï¼ï¼</p>
<p>æœ¬æ–‡åˆ†äº«åˆ°æ­¤ç»“æŸï¼Œå¦‚æœè¿‡ç¨‹é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿åœ¨ä¸‹é¢è¯„è®ºåŒºç»™ç¬”è€…ç•™è¨€ï¼Œå¹¶ç•™ä¸‹æ‚¨çš„é‚®ç®±ï¼Œæ–¹ä¾¿ç¬”è€…è”ç³»</p>
]]></content>
      <categories>
        <category>Tools</category>
        <category>Shadowsocks</category>
      </categories>
  </entry>
  <entry>
    <title>Next.jséƒ¨ç½²webåŒæ„ç›´å‡ºåº”ç”¨å…¨æŒ‡å—ï¼ˆMobx + Typescriptï¼‰</title>
    <url>/Programming/JavaScript/Next.js%20with%20TypeScript%20and%20Mobx/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ‰å…³Next.jsã€åŒæ„ç›´å‡ºã€SEOã€SPAç­‰ç›¸å…³ä»‹ç»å°†ä¸å†èµ˜è¿°ï¼Œæœ¬æ–‡ä¸»è¦é’ˆå¯¹Next.jsé…åˆtypescriptå’Œmobxæ­å»ºä¸€ä¸ªå®Œæ•´çš„ç”Ÿäº§éƒ¨ç½²çš„å‰ç«¯å·¥ç¨‹è¿›è¡Œæ ¸å¿ƒä»£ç çš„åˆ†æä»¥åŠä¸»è¦å‘ç‚¹çš„è®²è§£ï¼ŒéNext.jså…¥é—¨è¯¾ç¨‹ï¼Œä¸‹é¢æˆ‘å°†ä¼šåˆ—å‡ºæœ¬æ•™ç¨‹æ‰€éœ€è¦çš„å‰ç½®é¢„å¤‡çŸ¥è¯†å’Œèƒ½åŠ›ï¼š</p>
<ul>
<li>nodejsæœåŠ¡ç«¯ç¼–ç¨‹åŸºç¡€</li>
<li>å·²è‡³å°‘é˜…è¯»ä¸€éNext.jså®˜æ–¹æ–‡æ¡£</li>
<li>ç†Ÿç»ƒä½¿ç”¨reactjs</li>
<li>ç†Ÿç»ƒä½¿ç”¨webpack</li>
<li>ç†è§£åŒæ„ç›´å‡ºçš„æ¦‚å¿µå’Œå®ƒè§£å†³äº†ä»€ä¹ˆæ ·çš„ç—›ç‚¹</li>
<li>æœ‰ä¸€å®šçš„å‰ç«¯å·¥ç¨‹åŒ–ã€è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ç»éªŒ</li>
</ul>
<p>æ­£æ–‡å¼€å§‹æ—¶ï¼Œä¹Ÿå°±é»˜è®¤äº†æœ‰ç¼˜é˜…è¯»åˆ°æ­¤æ–‡çš„åŒå­¦å‡å…·å¤‡ä¸Šè¿°èƒ½åŠ›</p>
<p>åŸæ–‡åœ°å€ï¼š<a href="https://echo-lynn.github.io/Programming/JavaScript/Next.js%20with%20TypeScript%20and%20Mobx/" target="_blank" rel="noopener"><strong>Echo Lynnâ€™s Blog</strong></a></p>
<p>ä½œè€…å°†åœ¨åŸæ–‡ä¸ŠæŒç»­åˆ†äº«å…³äºNext.jsçš„é«˜çº§æ‹“å±•ç»éªŒï¼Œæœ‰å…´è¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥åœ¨åšå®¢ä¸Šç•™è¨€ä½ é‡åˆ°çš„é—®é¢˜æˆ–è€…ä¸ä½œè€…äº¤æµ</p>
<a id="more"></a>

<h1 id="åˆ›å»ºåŸºäºtypescriptçš„é¡¹ç›®"><a href="#åˆ›å»ºåŸºäºtypescriptçš„é¡¹ç›®" class="headerlink" title="åˆ›å»ºåŸºäºtypescriptçš„é¡¹ç›®"></a>åˆ›å»ºåŸºäºtypescriptçš„é¡¹ç›®</h1><p>Zeitåœ¨2019/07å‘å¸ƒäº†Next.js 9 è¯¥ç‰ˆæœ¬æœ€å¸äººçœ¼çƒçš„ä¸¤ä¸ªFeatureåˆ†åˆ«æ˜¯ <strong>Built-in Zero-Config TypeScript Support</strong> å’Œ <strong>File system-Based Dynamic Routing</strong> å³<strong>é›¶é…ç½®å†…ç½®TypeScriptæ”¯æŒ</strong>å’Œ<strong>åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„åŠ¨æ€è·¯ç”±æ”¯æŒ</strong>ï¼Œè¿™é‡Œä¸»è¦æåŠä¸€ä¸‹å…³äºTypeScriptçš„æ”¯æŒã€‚åœ¨9.0ä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒNext.jsä»6.0å¼€å§‹é€šè¿‡ä¸€ä¸ªåä¸º <em>@zeit/next-typescript</em> æä¾›äº†åŸºç¡€ç‰ˆæœ¬çš„TypeScriptæ”¯æŒï¼Œä½†å¹¶æ²¡æœ‰æ•´åˆç±»å‹æ£€æŸ¥ï¼ŒNext.jsæ ¸å¿ƒä»£ç æœ¬èº«ä¹Ÿä¸æä¾›typesç±»å‹æ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æä¾›çš„TypeScriptæ”¯æŒå¹¶ä¸å‹å¥½ã€‚Zeitæœ¬æ¬¡å‘å¸ƒçš„Next.js 9 æ ¸å¿ƒä»£ç ä½¿ç”¨TypeScripté‡æ„ï¼Œå› æ­¤ç»™å¼€å‘ä½“éªŒå¸¦æ¥äº†æè‡´çš„æå‡ã€‚ä»¥ä¸‹å°†ä½¿ç”¨å®˜æ–¹æä¾›çš„Demo <em>with-typescript</em> ä½œä¸ºç§å­é¡¹ç›®ï¼Œåé¢å†…å®¹å°†åœ¨è¿™ä¸ªé¡¹ç›®ä¸Šè¿›è¡Œé›†æˆ</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx create-next-app --example with-typescript with-typescript-app</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">yarn create next-app --example with-typescript with-typescript-app</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> with-typescript-app</span><br><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">with-typescript-app</span><br><span class="line">â”œâ”€ .gitignore</span><br><span class="line">â”œâ”€ README.md</span><br><span class="line">â”œâ”€ components</span><br><span class="line">â”‚  â”œâ”€ Layout.tsx</span><br><span class="line">â”‚  â”œâ”€ List.tsx</span><br><span class="line">â”‚  â”œâ”€ ListDetail.tsx</span><br><span class="line">â”‚  â””â”€ ListItem.tsx</span><br><span class="line">â”œâ”€ interfaces</span><br><span class="line">â”‚  â””â”€ index.ts</span><br><span class="line">â”œâ”€ next-env.d.ts</span><br><span class="line">â”œâ”€ package.json</span><br><span class="line">â”œâ”€ pages</span><br><span class="line">â”‚  â”œâ”€ about.tsx</span><br><span class="line">â”‚  â”œâ”€ detail.tsx</span><br><span class="line">â”‚  â”œâ”€ index.tsx</span><br><span class="line">â”‚  â””â”€ initial-props.tsx</span><br><span class="line">â”œâ”€ tsconfig.json</span><br><span class="line">â”œâ”€ utils</span><br><span class="line">â”‚  â””â”€ sample-api.ts</span><br><span class="line">â””â”€ yarn.lock</span><br></pre></td></tr></table></figure>

<h1 id="ä½¿ç”¨mobxä½œä¸ºappçŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"><a href="#ä½¿ç”¨mobxä½œä¸ºappçŠ¶æ€ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="ä½¿ç”¨mobxä½œä¸ºappçŠ¶æ€ç®¡ç†æ–¹æ¡ˆ"></a>ä½¿ç”¨mobxä½œä¸ºappçŠ¶æ€ç®¡ç†æ–¹æ¡ˆ</h1><p>æœ‰å…³Mobxçš„ä»‹ç»è¯·è‡ªè¡Œå®˜ç½‘æŸ¥é˜…ï¼š[<a href="https://mobx.js.org/]" target="_blank" rel="noopener">https://mobx.js.org/]</a></p>
<h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><p>å®‰è£…mobxã€mobx-reactæ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add mobx mobx-react</span><br><span class="line">// or</span><br><span class="line">npm install --save mobx mobx-react</span><br></pre></td></tr></table></figure>

<p>å®‰è£…babel pluginå¯¹è£…é¥°å™¨æä¾›ç¼–è¯‘æ”¯æŒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add -D @babel/plugin-proposal-class-properties @babel/plugin-proposal-decorators</span><br><span class="line">// or</span><br><span class="line">npm install --save-dev @babel/plugin-proposal-class-properties @babel/plugin-proposal-decorators</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åˆ›å»ºä¸€ä¸ª.babelrcçš„æ–‡ä»¶åœ¨å·¥ç¨‹çš„æ ¹ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">touch .babelrc</span><br><span class="line">vi .babelrc</span><br></pre></td></tr></table></figure>

<p>å†™å…¥</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    <span class="string">"next/babel"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-decorators"</span>, &#123; <span class="attr">"legacy"</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    [<span class="string">"@babel/plugin-proposal-class-properties"</span>, &#123; <span class="attr">"loose"</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶åœ¨tsconfig.jsonä¸­åŠ å…¥ä¸€è¡Œé…ç½®æ¥ä½¿tsæ”¯æŒè£…é¥°å™¨è¯­æ³•ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="storeå­æ¨¡å—ä»£ç å®ç°"><a href="#storeå­æ¨¡å—ä»£ç å®ç°" class="headerlink" title="storeå­æ¨¡å—ä»£ç å®ç°"></a>storeå­æ¨¡å—ä»£ç å®ç°</h2><p>åˆ›å»ºstoresæ–‡ä»¶å¤¹å¹¶åˆ›å»ºuser.tsï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir stores</span><br><span class="line">touch stores/user.ts</span><br></pre></td></tr></table></figure>

<p>å†™å…¥:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;action, observable&#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> UserStore &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span> name: <span class="built_in">string</span> = <span class="string">'Clint'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params">initialState: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = initialState.name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@action</span> setName(name: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserStoreç±»ä¸­çš„æ„é€ å‡½æ•°çš„æ„ä¹‰æ˜¯ï¼š<strong>æ¥å—åˆå§‹åŒ–æ•°æ®æ¥å¯¹è¯¥storeä¸‹çš„çŠ¶æ€è¿›è¡Œåˆå§‹åŒ–æˆ–è€…å°†åœ¨æœåŠ¡ç«¯æ¸²æŸ“é¦–å±æ—¶å·²ç»äº§ç”Ÿçš„çŠ¶æ€åŒæ­¥åˆ°å®¢æˆ·ç«¯ï¼ˆè¿™é‡Œæ˜¯åŒæ„ç›´å‡ºä¸­çŠ¶æ€åŒæ­¥ä¸€ä¸ªéå¸¸å…³é”®çš„ç¯èŠ‚ï¼Œåªæœ‰ç†è§£å¾—è¶³å¤Ÿé€å½»ï¼ŒNext.jsæ‰èƒ½ç”¨å¾—å¾—å¿ƒåº”æ‰‹</strong><br>ç”±äºæ¯æ¬¡åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„storeå­æ¨¡å—éƒ½éœ€è¦å®ç°ä¸€æ ·çš„æ„é€ å‡½æ•°æ¥å¯¹æ¨¡å—ä¸­çš„çŠ¶æ€åˆå§‹åŒ–æˆ–åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªåŸºç±»ï¼Œè®©æ‰€æœ‰storeå­æ¨¡å—ç»§æ‰¿è¿™ä¸ªåŸºç±»æ¥ä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼š<br>åˆ›å»ºstores/base.tsï¼Œå†™å…¥ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// base.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Base &#123;</span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">initState: &#123; [key: <span class="built_in">string</span>]: <span class="built_in">any</span> &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> initState) &#123;</span><br><span class="line">      <span class="keyword">if</span> (initState.hasOwnProperty(k)) &#123;</span><br><span class="line">        <span class="keyword">this</span>[k] = initState[k]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹user.ts:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;action, observable&#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"><span class="keyword">import</span> Base <span class="keyword">from</span> <span class="string">'./base'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> UserStore <span class="keyword">extends</span> Base &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@observable</span> name: <span class="built_in">string</span> = <span class="string">'Clint'</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@action</span> setName(name: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºstores/config.tsï¼Œå½“æœ‰æ–°çš„storeå­æ¨¡å—éœ€è¦åˆ›å»ºæ—¶å€™ï¼Œåªè¦é€šè¿‡è¿™ä¸ªé…ç½®æ–‡ä»¶å¼•å…¥å­æ¨¡å—å³å¯è‡ªåŠ¨é›†æˆåˆ°æ ¹storeä¸­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">touch stores/config.ts</span><br></pre></td></tr></table></figure>

<p>å†™å…¥ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> userStore <span class="keyword">from</span> <span class="string">'./user'</span></span><br><span class="line"><span class="keyword">import</span> Base <span class="keyword">from</span> <span class="string">'./base'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config: &#123; [key: <span class="built_in">string</span>]: <span class="keyword">typeof</span> Base &#125; = &#123;</span><br><span class="line">  userStore</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> config</span><br></pre></td></tr></table></figure>

<h2 id="mobxä¸»ä½“é€»è¾‘"><a href="#mobxä¸»ä½“é€»è¾‘" class="headerlink" title="mobxä¸»ä½“é€»è¾‘"></a>mobxä¸»ä½“é€»è¾‘</h2><p>ä¼˜åŒ–äº†storeå­æ¨¡å—çš„ä»£ç ä»¥åï¼Œæ¥ä¸‹æ¥å®ç°storeçš„ä¸»ä½“é€»è¾‘ï¼Œåˆ›å»ºstores/index.tsï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">touch stores/index.ts</span><br></pre></td></tr></table></figure>

<p>å†™å…¥:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useStaticRendering&#125; <span class="keyword">from</span> <span class="string">'mobx-react'</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isServer = <span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'undefined'</span></span><br><span class="line"><span class="comment">// Comment 1</span></span><br><span class="line">useStaticRendering(isServer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Store &#123;</span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line">  <span class="comment">// Comment 2</span></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">initialState: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> config) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.hasOwnProperty(k)) &#123;</span><br><span class="line">        <span class="keyword">this</span>[k] = <span class="keyword">new</span> config[k](initialState[k])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store: <span class="built_in">any</span> = <span class="literal">null</span></span><br><span class="line"><span class="comment">// Comment 3</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initializeStore</span>(<span class="params">initialState = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isServer) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Store(initialState)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (store === <span class="literal">null</span>) &#123;</span><br><span class="line">    store = <span class="keyword">new</span> Store(initialState)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç æ³¨é‡Šï¼š</p>
<ol>
<li>ç”±äºNext.jsé¦–å±æ¸²æŸ“æ˜¯åœ¨æœåŠ¡ç«¯æ‰§è¡Œçš„ï¼ŒMobxæ‰€åˆ›å»ºçš„çŠ¶æ€æ˜¯å¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œä½¿ç”¨Mobxåˆ›å»ºçš„å¯è§‚å¯Ÿå¯¹è±¡ä¼šåœ¨å†…å­˜ä¸­ä½¿ç”¨listeneræ¥ç›‘å¬å¯¹è±¡çš„å˜åŒ–ï¼Œä½†å®é™…ä¸Šåœ¨æœåŠ¡ç«¯æ˜¯æ²¡æœ‰å¿…è¦ç›‘å¬å˜åŒ–çš„ï¼Œå› ä¸ºé¦–å±æ¸²æŸ“å®Œæˆå¾—åˆ°htmlæ–‡ä»¶åï¼Œåç»­çš„å·¥ä½œéƒ½ç”±å®¢æˆ·ç«¯æ¥æ‰‹ï¼Œæ‰€ä»¥å¦‚æœåœ¨æœåŠ¡ç«¯çš„å¯¹è±¡æ˜¯å¯è§‚å¯Ÿçš„ï¼Œå°†æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨useStaticRenderingæ–¹æ³•ï¼Œå½“è¯¥æ–‡ä»¶åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ—¶ï¼Œè®©Mobxåˆ›å»ºé™æ€çš„æ™®é€šjså¯¹è±¡å³å¯</li>
<li>æ„é€ å‡½æ•°å°†åœ¨Mobxçš„æ ¹storeä¸‹æŒ‚è½½ä¸Šæ–‡åˆ›å»ºçš„å­æ¨¡å—ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„åˆå§‹çŠ¶æ€/æœåŠ¡ç«¯é€ä¼ çš„çŠ¶æ€ä¸€ä¸€èµ‹å€¼ç»™å­æ¨¡å—ï¼Œ<strong>å½“èµ‹å€¼è¿‡ç¨‹æ˜¯æœåŠ¡ç«¯çŠ¶æ€åŒæ­¥æ—¶ï¼Œç”±äºæ‰§è¡Œç¯å¢ƒæ˜¯å®¢æˆ·ç«¯ï¼Œå­æ¨¡å—ä¸­çš„çŠ¶æ€å°†é‡æ–°è·å¾—å¯è§‚å¯Ÿçš„å±æ€§ï¼Œèƒ½å¤Ÿè®©ä½¿ç”¨äº†è¯¥çŠ¶æ€å€¼çš„reactç»„ä»¶å“åº”å˜åŒ–</strong></li>
<li><em>initializeStore</em> æ–¹æ³•ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œæ¯ä¸ªç‹¬ç«‹çš„è¯·æ±‚éƒ½å°†åˆ›å»ºä¸€ä¸ªæ–°çš„storeï¼Œä»¥æ­¤æ¥éš”ç¦»è¯·æ±‚ä¹‹é—´çš„çŠ¶æ€æ··æ·†ï¼Œå½“å®¢æˆ·ç«¯æ¸²æŸ“æ—¶ï¼Œåªéœ€è¦å¼•ç”¨ä¹‹å‰å·²ç»åˆ›å»ºè¿‡çš„storeå³å¯ï¼Œå› ä¸ºåŒä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆSPAï¼‰åº”è¯¥å…±äº«ä¸€é¢—çŠ¶æ€æ ‘<br>ä»¥ä¸Šå³MobxçŠ¶æ€ç®¡ç†çš„ä¸»é€»è¾‘å®ç°ï¼Œæ¥ä¸‹æ¥å°†è®²è¿°Mobxå¦‚ä½•é…åˆNext.jså’Œreactå®ç°çŠ¶æ€ç®¡ç†<h2 id="mobx-react"><a href="#mobx-react" class="headerlink" title="mobx-react"></a>mobx-react</h2></li>
</ol>
<p>Mobxé…åˆreactå®ç°çŠ¶æ€ç®¡ç†å¯ä»¥å¼•ç”¨mobx-reactæ¥å®ç°ï¼Œå†™ä»£ç ä¹‹å‰æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹éœ€æ±‚ï¼Œå³å¸Œæœ›è¾¾Mobxå…·å¤‡ä»€ä¹ˆæ ·èƒ½åŠ›ã€‚</p>
<p>å‰æ–‡æˆ‘ä»¬è®¾è®¡Mobxä»£ç ç»“æ„çš„æ—¶å€™ï¼Œå®ç°äº†ä¸€ä¸ªstoreçš„å­æ¨¡å—æ¦‚å¿µï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œ<strong>èƒ½é€šè¿‡æ³¨å…¥çš„æ–¹å¼ï¼Œç»™é¡µé¢æŒ‰éœ€åŠ è½½æˆ‘ä»¬æ‰€éœ€è¦çš„storeå­æ¨¡å—å—ï¼Ÿ</strong></p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬éƒ½å·²ç»çŸ¥é“ï¼ŒNext.jsæ˜¯é€šè¿‡ä¸€ä¸ªå®ç°ä¸€ä¸ªåä¸º<em>getInitialProps<em>çš„é™æ€æ–¹æ³•æ¥åšåˆ°å½“é¡µé¢è¢«é¦–å±è¯·æ±‚çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡ç«¯æ‰§è¡Œ</em>getInitialProps<em>ä»è€Œè·å–é¡µé¢æ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ¥åšæœåŠ¡ç«¯æ¸²æŸ“çš„ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªé—®é¢˜ï¼š*</em>å¦‚ä½•åœ¨ *getInitialProps</em> ä¸­è·å–storeå¯¹è±¡ï¼Ÿ**</p>
<p>ç¬¬ä¸‰ï¼Œä¸Šæ–‡åŒæ ·æåˆ°äº†ï¼Œæˆ‘ä»¬æœåŠ¡ç«¯é¦–å±æ¸²æŸ“çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€äº›åˆå§‹çŠ¶æ€å­˜åœ¨storeçš„æŸä¸ªæˆ–è€…æŸäº›å­æ¨¡å—ä¸­ï¼Œé‚£ä¹ˆ<strong>Next.jsæ˜¯é€šè¿‡ä»€ä¹ˆæ‰‹æ®µå°†è¿™äº›çŠ¶æ€å¸¦ç»™å®¢æˆ·ç«¯çš„</strong> è€Œ <strong>æˆ‘ä»¬åˆæ€æ ·æ‰èƒ½è®©è¿™äº›çŠ¶æ€åŒæ­¥åˆ°å®¢æˆ·ç«¯çš„storeå¯¹è±¡é‡Œæ¥ä¿æŒæœåŠ¡ç«¯å®¢æˆ·ç«¯çŠ¶æ€ä¸€è‡´å‘¢ï¼Ÿ</strong>è¿™æ˜¯ç¬¬ä¸‰å’Œç¬¬å››ä¸ªé—®é¢˜ã€‚å½’çº³ä¸€ä¸‹éœ€è¦è§£å†³çš„äº‹åŠ¡ï¼š</p>
<ol>
<li>å‘reactç»„ä»¶æ³¨å…¥storeå­æ¨¡å—</li>
<li>åœ¨<em>getInitialProps</em>æ–¹æ³•ä¸­ä½¿ç”¨storeå¯¹è±¡å¡«å……æ•°æ®</li>
<li>åˆ†æNext.jsæ•°æ®ä»æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯åŒæ­¥çš„æœºåˆ¶</li>
<li>åŒæ­¥æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„storeçŠ¶æ€</li>
</ol>
<p>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦é‡å†™Next.jsçš„<em>_app.tsx</em>æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">touch pages/_app.tsx</span><br></pre></td></tr></table></figure>

<p>å†™å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/_app.tsx</span><br><span class="line">import App, &#123;AppContext&#125; from &apos;next/app&apos;</span><br><span class="line">import React from &apos;react&apos;</span><br><span class="line">import &#123;initializeStore, Store&#125; from &apos;../stores&apos;</span><br><span class="line">import &#123;Provider&#125; from &apos;mobx-react&apos;</span><br><span class="line"></span><br><span class="line">class MyMobxApp extends App &#123;</span><br><span class="line"></span><br><span class="line">  mobxStore: Store</span><br><span class="line"></span><br><span class="line">  // Fetching serialized(JSON) store state</span><br><span class="line">  static async getInitialProps(appContext: AppContext): Promise&lt;any&gt; &#123;</span><br><span class="line">    const ctx: any = appContext.ctx</span><br><span class="line">    // Comment 1</span><br><span class="line">    ctx.mobxStore = initializeStore()</span><br><span class="line">    const appProps = await App.getInitialProps(appContext)</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      ...appProps,</span><br><span class="line">      initialMobxState: ctx.mobxStore</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  constructor(props: any) &#123;</span><br><span class="line">    super(props)</span><br><span class="line">    // Comment 2</span><br><span class="line">    const isServer = typeof window === &apos;undefined&apos;</span><br><span class="line">    this.mobxStore = isServer ? props.initialMobxState : initializeStore(props.initialMobxState)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123;Component, pageProps&#125;: any = this.props</span><br><span class="line">    return (</span><br><span class="line">      // Comment 3</span><br><span class="line">      &lt;Provider &#123;...this.mobxStore&#125;&gt;</span><br><span class="line">        &lt;Component &#123;...pageProps&#125; /&gt;</span><br><span class="line">      &lt;/Provider&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default MyMobxApp</span><br></pre></td></tr></table></figure>

<p>ä»£ç æ³¨é‡Šï¼š</p>
<ol>
<li><p>åˆ›å»ºï¼ˆæœåŠ¡ç«¯ï¼‰æˆ–è·å–ï¼ˆå®¢æˆ·ç«¯ï¼‰storeå¯¹è±¡å‘½åä¸ºmobxStoreï¼Œå°†mobxStoreæŒ‚è½½åˆ°appContext.ctxå¯¹è±¡ä¸Šï¼Œè¿™ä¸ªå¯¹è±¡ä¼šåœ¨é¡µé¢çš„<em>getInitialProps</em>æ–¹æ³•ä¸­ä½œä¸ºå…¥å‚ä¼ å…¥ï¼Œè¿™å°±è§£å†³äº†ä¸Šè¿°çš„ç¬¬äºŒä¸ªé—®é¢˜</p>
</li>
<li><p>è¿™é‡Œå…¶å®éœ€è¦å…ˆè§£é‡Šä¸€ä¸‹Next.jsåŒæ„ç›´å‡ºçš„åŸç†ï¼š<strong>å½“é¦–å±è¢«è¯·æ±‚æ—¶ï¼ŒNext.jsåœ¨æœåŠ¡ç«¯åˆ©ç”¨reactæ¸²æŸ“é¡µé¢çš„æœºåˆ¶ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸåªä¼šæ‰§è¡Œåˆ°renderï¼‰æ¸²æŸ“å‡ºhtmlæ–‡ä»¶åï¼Œæ¥æ»¡è¶³SEOçš„éœ€æ±‚å’Œé¦–å±é¡µé¢çš„å±•ç¤ºï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰ï¼Œåˆ°äº†æµè§ˆå™¨ï¼ŒNext.jsåˆ™ä¼šè·‘ä¸€éå®Œæ•´Reactçš„ç”Ÿå‘½å‘¨æœŸæ¸²æŸ“ï¼Œæ‰€ä»¥åªè¦æ¸²æŸ“ç»“æœä¸€è‡´ï¼Œreactå†…ç½®çš„<em>diff</em>ç®—æ³•ç»“æœæ²¡æœ‰ä»»ä½•å·®å¼‚ï¼Œä½ å°†ä¸ä¼šçœ‹åˆ°é¡µé¢æœ‰ä»»ä½•å¯å¯Ÿè§‰çš„å˜åŒ–</strong><br>Next.jsé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥ä¿è¯ç¬¬äºŒç‚¹æåˆ°çš„<strong>æ¸²æŸ“ç»“æœä¸€è‡´</strong>å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬è¦è§£å†³çš„ç¬¬ä¸‰ä¸ªäº‹åŠ¡ã€‚Next.jsæœåŠ¡ç«¯æ¸²æŸ“htmlæ–‡ä»¶çš„åŒæ—¶ï¼Œå°†æœ¬æ¬¡è¯·æ±‚äº§ç”Ÿçš„æœ‰å…³æ•°æ®é€šè¿‡å†™å…¥scriptæ ‡ç­¾çš„æ–¹å¼æ’åœ¨htmlæ–‡ä»¶ä¸€å¹¶è¿”å›ã€‚èµ·ä¸€ä¸‹æœ¬åœ°æœåŠ¡ï¼Œæˆ‘ä»¬ä½¿ç”¨Chromeæ§åˆ¶å°çœ‹ä¸€ä¸‹å®é™…æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script id=<span class="string">"__NEXT_DATA__"</span> type=<span class="string">"application/json"</span>&gt;</span><br><span class="line">  &#123;<span class="string">"dataManager"</span>:<span class="string">"[]"</span>,<span class="string">"props"</span>:&#123;<span class="string">"pageProps"</span>:&#123;&#125;,<span class="string">"initialMobxState"</span>:&#123;<span class="string">"userStore"</span>:&#123;&#125;&#125;&#125;,<span class="string">"page"</span>:<span class="string">"/"</span>,<span class="string">"query"</span>:&#123;&#125;,<span class="string">"buildId"</span>:<span class="string">"development"</span>&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ï¼Œ<strong>Next.jsè¿è¡Œåœ¨å®¢æˆ·ç«¯æ—¶ä¼šä¾æ®æœåŠ¡ç«¯å¸¦å›çš„<em><strong>NEXT_DATA</strong></em>æ„å»ºReact SPA</strong>ï¼Œè¿™å°±æ˜¯åŒæ„ç›´å‡ºçš„æ ¸å¿ƒåŸç†ã€‚</p>
<p>ä»ä¸Šé¢å¾—åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°<em>initialMobxState</em>è¢«å¸¦å›ï¼Œè¿™æ—¶ï¼Œå›è¿‡å¤´æ¥çœ‹ä¸‹<em>pages/_app.tsx</em>ä¸­çš„ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(<span class="params">props: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">const</span> isServer = <span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">'undefined'</span></span><br><span class="line">    <span class="keyword">this</span>.mobxStore = isServer ? props.initialMobxState : initializeStore(props.initialMobxState)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ„é€ å‡½æ•°çš„æ‰§è¡Œç¯å¢ƒä¸ºå®¢æˆ·ç«¯æ—¶ï¼Œstoreå¯¹è±¡ä¼šä¾æ®<em><strong>NEXT_DATA</strong></em>ä¸­çš„<em>props.initialMobxState</em>è¢«åˆ›å»ºï¼Œè¿™å°±å®Œæˆäº†æœåŠ¡ç«¯storeçš„çŠ¶æ€å‘å®¢æˆ·ç«¯åŒæ­¥ï¼Œè¿™å°±è§£å†³äº†äº‹åŠ¡4</p>
</li>
</ol>
<ol start="3">
<li><p>å°†storeä½¿ç”¨æ‹“å±•è¿ç®—ç¬¦å°†å­æ¨¡å—é€šè¿‡propsæ³¨å…¥åˆ°<em>provider</em>ç»„ä»¶ï¼Œé…åˆmobx-reactæä¾›çš„<em>inject</em>æ–¹æ³•æ¥è¾¾åˆ°æŒ‰éœ€è·å–storeæ¨¡å—çš„åŠŸèƒ½ï¼Œä¸‹é¢ç»™å‡ºä¸€ç§ç”¨æ³•ä»£ç ç¤ºä¾‹ï¼Œæ›´å¤šä½¿ç”¨æ–¹å¼è¯·ç§»æ­¥mobx-react[<a href="https://github.com/mobxjs/mobx-react]" target="_blank" rel="noopener">https://github.com/mobxjs/mobx-react]</a> äº†è§£æ›´å¤š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/detail.tsx</span><br><span class="line">import * as React from &apos;react&apos;</span><br><span class="line">import Layout from &apos;../components/Layout&apos;</span><br><span class="line">import &#123;User&#125; from &apos;../interfaces&apos;</span><br><span class="line">import &#123;findData&#125; from &apos;../utils/sample-api&apos;</span><br><span class="line">import ListDetail from &apos;../components/ListDetail&apos;</span><br><span class="line">import &#123;inject, observer&#125; from &apos;mobx-react&apos;</span><br><span class="line">import UserStore from &apos;../stores/user&apos;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  item?: User</span><br><span class="line">  userStore: UserStore</span><br><span class="line">  errors?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@inject(&apos;userStore&apos;)</span><br><span class="line">@observer</span><br><span class="line">class InitialPropsDetail extends React.Component&lt;Props&gt; &#123;</span><br><span class="line">  static getInitialProps = async (&#123;query, mobxStore&#125;: any) =&gt; &#123;</span><br><span class="line">    mobxStore.userStore.setName(&apos;set by server&apos;)</span><br><span class="line">    try &#123;</span><br><span class="line">      const &#123;id&#125; = query</span><br><span class="line">      const item = await findData(Array.isArray(id) ? id[0] : id)</span><br><span class="line">      return &#123;item&#125;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      return &#123;errors: err.message&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123;item, errors&#125; = this.props</span><br><span class="line"></span><br><span class="line">    if (errors) &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;Layout title=&#123;`Error | Next.js + TypeScript Example`&#125;&gt;</span><br><span class="line">          &lt;p&gt;</span><br><span class="line">            &lt;span style=&#123;&#123;color: &apos;red&apos;&#125;&#125;&gt;Error:&lt;/span&gt; &#123;errors&#125;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">        &lt;/Layout&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;Layout</span><br><span class="line">        title=&#123;`$&#123;item ? item.name : &apos;Detail&apos;&#125; | Next.js + TypeScript Example`&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;item &amp;&amp; &lt;ListDetail item=&#123;item&#125;/&gt;&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">          Name: &#123;this.props.userStore.name&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; &#123;</span><br><span class="line">          this.props.userStore.setName(&apos;set by client&apos;)</span><br><span class="line">        &#125;&#125;&gt;click to set name</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/Layout&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default InitialPropsDetail</span><br></pre></td></tr></table></figure>

<p>è®¿é—®: [<a href="http://localhost:3000/detail?id=101]" target="_blank" rel="noopener">http://localhost:3000/detail?id=101]</a> æŸ¥çœ‹æ•ˆæœ</p>
</li>
</ol>
<p>ä»¥ä¸Šï¼Œå°±æ˜¯åŸºäºNext.jså¼€å‘çš„å‡ ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„æ€æƒ³å’Œåº“çš„ä½¿ç”¨ï¼Œä¸‹é¢å¼€å§‹ä»‹ç»åœ¨æ„å»ºå’Œéƒ¨ç½²æ–¹é¢çš„å†…å®¹</p>
<h1 id="æ„å»ºç¼–è¯‘"><a href="#æ„å»ºç¼–è¯‘" class="headerlink" title="æ„å»ºç¼–è¯‘"></a>æ„å»ºç¼–è¯‘</h1><p>Next.jsä½¿ç”¨webpackæ¥æ„å»ºæ‰“åŒ…é¡¹ç›®ï¼Œå½“é¡¹ç›®ä¸éœ€è¦ç‰¹æ®Šçš„å®šåˆ¶åŒ–æ„å»ºçš„æ—¶å€™ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯æ„å»ºé¡¹ç›®åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">next build</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰è¨€é‡Œä¹Ÿæåˆ°ï¼Œæœ¬æ–‡ç€é‡è®²éƒ¨ç½²Next.jsçš„å®Œæ•´å®ä¾‹ï¼Œé‚£ä¹ˆåªä»¥é»˜è®¤æ–¹å¼æ„å»ºé¡¹ç›®æ˜¾ç„¶æ˜¯æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„å®é™…çš„ç”Ÿäº§è¯‰æ±‚äº†ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œè®²ä¸€äº›å¹³å¸¸æˆ‘ä»¬æ„å»ºé¡¹ç›®æ‰€éœ€è¦çš„å‡ ä¸ªæ¯”è¾ƒé€šç”¨çš„éœ€æ±‚ç‚¹ï¼Œå½“ç„¶è¦†ç›–ä¸äº†æ‰€æœ‰ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æä¾›ä¸€äº›æ€è·¯ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œä¹Ÿé¡ºä¾¿ä¸€æï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ¡†æ¶æ¥æ­å»ºåº”ç”¨çš„æ—¶å€™ï¼Œ<strong>èƒ½ä½¿ç”¨æ¡†æ¶æœ¬èº«æä¾›çš„APIå®ç°åŠŸèƒ½è¯·å°½é‡ä½¿ç”¨</strong>ï¼Œè¿™æ ·åšçš„å¥½å¤„æœ‰å“ªäº›ï¼š</p>
<ol>
<li>é¿å…é‡å¤é€ è½®å­</li>
<li>è‡ªç„¶å½¢æˆä¸€å¥—è§„èŒƒå’Œæ ‡å‡†ï¼Œå›¢é˜Ÿå¼€å‘å‡å°‘å­¦ä¹ æˆæœ¬</li>
<li>æ–‡æ¡£ç°æˆï¼Œä½¿ç”¨èµ·æ¥æ°´åˆ°æ¸ æˆ</li>
<li>é¡¹ç›®é‡Œè¶Šå°‘å¸¦æœ‰ä¸»è§‚åå¥½çš„ä»£ç è¶Šå¥½</li>
</ol>
<h2 id="ç¯å¢ƒåˆ†å‰²"><a href="#ç¯å¢ƒåˆ†å‰²" class="headerlink" title="ç¯å¢ƒåˆ†å‰²"></a>ç¯å¢ƒåˆ†å‰²</h2><p>ä¸€ä¸ªç”Ÿäº§é¡¹ç›®é¿å…ä¸äº†ç¯å¢ƒè¿™ä¸ªé—®é¢˜ï¼Œæ¯”è¾ƒå¸¸è§çš„é¡¹ç›®ç¯å¢ƒåˆ†ä¸ºdev test productionï¼Œå³å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼Œä¸‹é¢æˆ‘ä»¬ä»¥è¿™ç±»ç¯å¢ƒåˆ’åˆ†ä¸ºä¾‹ï¼Œå¤šå‡ ç§æˆ–è€…å°‘å‡ ç§åŒç†å¯æ¨</p>
<p>é€šå¸¸æˆ‘ä»¬å°†é¡¹ç›®å†…å¼•ç”¨åˆ°çš„ç¯å¢ƒå˜é‡æŠ½ç¦»å‡ºæ¥ï¼Œç”¨é…ç½®æ–‡ä»¶æŠŠå˜é‡å­˜èµ·æ¥ï¼Œæ ¹æ®ç¨‹åºè¿è¡Œçš„ç¯å¢ƒæ¥ç´¢å¼•å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå–å‡ºå˜é‡ä½¿ç”¨</p>
<p>åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º<em>/config</em>ç›®å½•ï¼Œåˆ†åˆ«åˆ›å»º<em>dev.jsï¼Œtest.jsï¼Œprod.js</em>ï¼ˆæä¸€ä¸‹ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸æ˜¯.tsæ–‡ä»¶å‘¢ï¼Œå› ä¸ºè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ„å»ºæ—¶å€™è¢«å¼•ç”¨çš„æ–‡ä»¶ï¼Œæ˜¯ä¸ç»è¿‡tsç¼–è¯‘çš„ï¼‰<em>index.js</em>é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir config</span><br><span class="line">touch config/dev.js config/test.js config/prod.js config/index.js</span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«å†™å…¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/dev.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: <span class="string">'dev'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/test.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: <span class="string">'test'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/prod.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: <span class="string">'prod'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/index.js</span></span><br><span class="line"><span class="keyword">const</span> dev = <span class="built_in">require</span>(<span class="string">'./dev'</span>)</span><br><span class="line"><span class="keyword">const</span> test = <span class="built_in">require</span>(<span class="string">'./test'</span>)</span><br><span class="line"><span class="keyword">const</span> prod = <span class="built_in">require</span>(<span class="string">'./prod'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  dev,</span><br><span class="line">  test,</span><br><span class="line">  prod</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next.jsæ„å»º(<code>next build</code>)å’Œå¯åŠ¨åº”ç”¨(<code>next</code>ã€<code>next start</code>)é€šè¿‡åœ¨æ ¹ç›®å½•ä¸‹<em>next.config.js</em>æ–‡ä»¶è¯»å–å®šåˆ¶åŒ–çš„é…ç½®é€‰é¡¹ï¼Œå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨é»˜è®¤é…ç½®æ„å»º</p>
<p>åˆ›å»º<em>next.config.js</em></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">touch next.config.js</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./config'</span>)</span><br><span class="line"><span class="comment">// Get process DEPLOY_ENV value</span></span><br><span class="line"><span class="keyword">const</span> DEPLOY_ENV = process.env.DEPLOY_ENV || <span class="string">'dev'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  serverRuntimeConfig: &#123;</span><br><span class="line">    <span class="comment">// Will only be available on the server side</span></span><br><span class="line">    secret: <span class="string">'secret'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Use which config file according to DEPLOY_ENV</span></span><br><span class="line">  publicRuntimeConfig: config[DEPLOY_ENV]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹<em>pages/index.tsx</em>æ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// pages/index.tsx</span><br><span class="line">import * as React from &apos;react&apos;</span><br><span class="line">import Link from &apos;next/link&apos;</span><br><span class="line">import Layout from &apos;../components/Layout&apos;</span><br><span class="line">import &#123; NextPage &#125; from &apos;next&apos;</span><br><span class="line">import getConfig from &apos;next/config&apos;</span><br><span class="line"></span><br><span class="line">const &#123;publicRuntimeConfig, serverRuntimeConfig&#125; = getConfig()</span><br><span class="line"></span><br><span class="line">const IndexPage: NextPage = () =&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Layout title=&quot;Home | Next.js + TypeScript Example&quot;&gt;</span><br><span class="line">      &lt;h1&gt;Hello Next.js ğŸ‘‹&lt;/h1&gt;</span><br><span class="line">      &lt;p&gt;Public config JSON string: &#123;JSON.stringify(publicRuntimeConfig)&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;Server side config JSON string: &#123;JSON.stringify(serverRuntimeConfig)&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;Link href=&quot;/about&quot;&gt;</span><br><span class="line">          &lt;a&gt;About&lt;/a&gt;</span><br><span class="line">        &lt;/Link&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/Layout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default IndexPage</span><br></pre></td></tr></table></figure>

<p>Next.jsé…ç½®æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé…ç½®é€‰é¡¹<em>serverRuntimeConfig</em>ï¼Œ<em>publicRuntimeConfig</em>ï¼Œ<em>serverRuntimeConfig</em>åªå…è®¸ç¨‹åºè¿è¡Œåœ¨æœåŠ¡ç«¯æ—¶ä½¿ç”¨ï¼Œ<em>publicRuntimeConfig</em>é€‰é¡¹åŒæ—¶å…è®¸æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è·å–ï¼Œæˆ‘ç”¨<em>publicRuntimeConfig</em>è®²è§£æ€è·¯</p>
<p>å®Œæˆä»¥ä¸Šä»£ç ç¼–å†™åï¼Œæ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">next</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ [<a href="http://localhost:3000]æŸ¥çœ‹æ•ˆæœ" target="_blank" rel="noopener">http://localhost:3000]æŸ¥çœ‹æ•ˆæœ</a></p>
<p>å¯ä»¥æ³¨æ„åˆ°æµè§ˆå™¨æ˜¾ç¤ºäº†<em>publicRuntimeConfig</em>æ˜¯<em>config/dev.js</em>çš„å†…å®¹ï¼Œè€Œ<em>serverRuntimeConfig</em>ä¸ºç©ºå¯¹è±¡ï¼Œç»†å¿ƒçš„æœ‹å‹ä¼šæ³¨æ„åˆ°ï¼Œå½“ä½ å¿«é€Ÿä¸æ–­åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°<em>serverRuntimeConfig</em>æ˜¯ç”±<code>{&quot;secret&quot;:  &quot;secret&quot;}</code>å˜ä¸º<code>{}</code>çš„ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œç»“åˆä¸Šæ–‡æåˆ°çš„Next.jsåŒæ„ç›´å‡ºçš„æ ¸å¿ƒæ€æƒ³å’Œå…³äº<em>serverRuntimeConfig</em>çš„ç‰¹æ€§å°±å¯ä»¥ç†è§£è¯¥ç°è±¡äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼Œè®©ç¨‹åºæ„å»ºåè·‘åœ¨test/prodç¯å¢ƒæ—¶å€™ï¼Œé¡µé¢æ˜¾ç¤º<em>config/test.js</em>æˆ–è€…<em>config/prod.js</em>çš„å†…å®¹äº†</p>
<p>ä»¥testä¸ºä¾‹ï¼ŒNext.jsçš„æ„å»ºå‘½ä»¤ä¸º<code>next build</code>ï¼Œå¯åŠ¨å‘½ä»¤ä¸º<code>next start</code>ï¼Œè¿è¡Œå’Œæ„å»ºéƒ½ä¼šæ ¹æ®<em>next.config.js</em>æ¥å†³å®šåº”ç”¨æ„å»ºå’Œå¯åŠ¨çš„å®šåˆ¶åŒ–é…ç½®ï¼Œä»ä»£ç é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯æ ¹æ®ä¸€ä¸ªå«<em>DEPLOY_ENV</em>çš„ç¯å¢ƒå˜é‡æ¥ç´¢å¼•é…ç½®æ–‡ä»¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨è¿è¡Œ<code>next build</code>å’Œ<code>next start</code>çš„æ—¶å€™ç»™<em>DEPLOY_ENV</em>èµ‹å€¼å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DEPLOY_ENV=<span class="built_in">test</span> next build</span><br><span class="line">DEPLOY_ENV=<span class="built_in">test</span> next start</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤ï¼Œæ‰“å¼€[<a href="http://localhost:3000]æŸ¥çœ‹é¡µé¢æ˜¯å¦å·²æ˜¾ç¤º*config/test.js*çš„å†…å®¹ï¼Œæœ‰å…³ç¯å¢ƒåˆ†å‰²çš„å†…å®¹å°±è®²åˆ°è¿™é‡Œï¼Œæ›´å¤šæœ‰å…³ç¯å¢ƒçš„æ‹“å±•å¯ä»¥ä¾æ®è¿™æ ·çš„æ€è·¯æ¥å®ç°" target="_blank" rel="noopener">http://localhost:3000]æŸ¥çœ‹é¡µé¢æ˜¯å¦å·²æ˜¾ç¤º*config/test.js*çš„å†…å®¹ï¼Œæœ‰å…³ç¯å¢ƒåˆ†å‰²çš„å†…å®¹å°±è®²åˆ°è¿™é‡Œï¼Œæ›´å¤šæœ‰å…³ç¯å¢ƒçš„æ‹“å±•å¯ä»¥ä¾æ®è¿™æ ·çš„æ€è·¯æ¥å®ç°</a></p>
<h2 id="CSSé¢„ç¼–è¯‘"><a href="#CSSé¢„ç¼–è¯‘" class="headerlink" title="CSSé¢„ç¼–è¯‘"></a>CSSé¢„ç¼–è¯‘</h2><p>è¿™ä¸ªå°±æ›´åŠ ç®€å•äº†ï¼Œå®˜æ–¹æä¾›æ’ä»¶çš„ï¼Œæˆ‘å°±ä¸è´¹å£èˆŒè®²ä¸€éäº†ï¼Œç›´æ¥ä¸Šé“¾æ¥</p>
<p>å€¼å¾—ä¸€ææ˜¯çš„ï¼ŒNext.jsåœ¨CSSæ–¹é¢æœ‰ä¸€ç‚¹ä¸è¶³ï¼š<strong>æ‰€æœ‰çš„æ ·å¼æ–‡ä»¶æœ€ç»ˆä¼šè¢«æ‰“åŒ…ä¸ºä¸€ä¸ª<em>style.chunk.css</em>æ–‡ä»¶éšç€é¦–å±åŠ è½½ä¸€å¹¶è¿”å›</strong>ã€‚è¿™ä¼šå¸¦æ¥ä¸€ç‚¹å°å°çš„ç¼ºé™·å°±æ˜¯å½“ä½ çš„appå·¥ç¨‹åºå¤§æ—¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½“ç§¯ä¼šå¯¹é¦–å±çš„åŠ è½½å¸¦æ¥ä¸€ç‚¹å½±å“ï¼Œè™½ç„¶åœ¨gzipå‹ç¼©åè¿™ç§å½±å“å¾®ä¹å…¶å¾®ï¼Œä¸è¿‡ç»ˆå½’æ˜¯éœ€è¦ä¼˜åŒ–ï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œç±»åå†²çªäº†ï¼Œä½ å¯èƒ½éœ€è¦åˆ©ç”¨åƒLessã€Sassè¿™æ ·çš„åµŒå¥—æ ·å¼å†™æ³•æŠŠä¸ç›¸å…³çš„é¡µé¢æ ·å¼åŒ…è£¹åœ¨ä¸€ä¸ªå‘½åç©ºé—´é‡Œï¼Œæˆ–è€…æ˜¯é€šè¿‡é…ç½®<code>{cssModules: true}</code>æ¥ä¸ºä½ çš„ç±»åæ‰“ä¸Šhashåç¼€ã€‚</p>
<p>å…³äºCSSæ–‡ä»¶åˆ‡å‰²çš„é—®é¢˜ç¬”è€…å·²ç»ç»™Next.jsä½œè€…æäº†issueäº†ï¼ŒæœŸå¾…åç»­ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>åŠ¨æ‰‹èƒ½åŠ›å¼ºwebpackåŸç†å¤Ÿç¡¬çš„åŒå­¦ä¹Ÿå¯ä»¥å°è¯•è‡ªå·±å®ç°ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚ç¬”è€…åé¢ç©ºä¸‹æ¥æœ‰å¹¸å®ç°äº†çš„è¯ï¼Œä¼šå†åˆ†äº«å‡ºæ¥ã€‚</p>
<h1 id="æœåŠ¡éƒ¨ç½²"><a href="#æœåŠ¡éƒ¨ç½²" class="headerlink" title="æœåŠ¡éƒ¨ç½²"></a>æœåŠ¡éƒ¨ç½²</h1><p>Next.jsä¸åŒäºæ™®é€šçš„é™æ€webé¡¹ç›®ï¼Œå½“ç„¶ï¼ŒNext.jsä¹Ÿå¯ä»¥æ­å»ºä¸€ä¸ªæ™®é€šçš„é™æ€é¡¹ç›®ï¼Œä¸è¿‡åŒæ„ç›´å‡ºæ‰æ˜¯å®ƒçš„æœ€å¤§äº®ç‚¹ï¼Œæ‰€ä»¥æœ¬æ–‡æ‰€æœ‰ç¯‡å¹…éƒ½æ˜¯åŸºäºè¿™ä¸ªç‚¹å‡ºå‘çš„ï¼Œä¸è®¨è®ºå…¶ä»–å°ä¼—æ–¹å¼è¿è¡ŒNext.js</p>
<p>é‚£ä¹ˆæƒ³éƒ¨ç½²åŒæ„ç›´å‡ºï¼Œå°±éœ€è¦æœ‰webæœåŠ¡å™¨ï¼Œå‰ç«¯é¢†åŸŸç›®å‰æ¯”è¾ƒçƒ­é—¨çš„è¿˜æ˜¯Node.jsï¼ŒNext.jsçš„æœåŠ¡ç«¯ä¹Ÿæ­£æ˜¯è¿è¡Œåœ¨Node.jsä¸Šï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹Next.jsç®€å•çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œç„¶åç»§ç»­é’ˆå¯¹ä¸€äº›æˆ‘è®¤ä¸ºå‡ºç°é¢‘ç¹çš„ä¸€äº›åœºæ™¯è®²è§£ä¸€ä¸‹éƒ¨ç½²æ€è·¯ã€‚</p>
<p>éƒ¨ç½²é¡¹ç›®å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ä¸€æ˜¯æŠŠæ•´ä¸ªé¡¹ç›®ç›®å½•é™¤äº†<em>node_modules</em>ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªç›®å½•å¸¦ä¸Šå»ï¼Œå¦‚æœä½ è¿æ¥æœåŠ¡ç«¯ä¼ è¾“ç½‘é€Ÿå¤Ÿå¿«çš„è¯ï¼‰ä»¥å¤–çš„æºæ–‡ä»¶ä¸€å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå®‰è£…é¡¹ç›®ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn</span><br><span class="line">// or</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>æ„å»º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DEPLOY_ENV=<span class="variable">$YOUR_SERVER_ENV_TYPE</span> next build</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DEPLOY_ENV=<span class="variable">$YOUR_SERVER_ENV_TYPE</span> next start</span><br></pre></td></tr></table></figure>

<p>äºŒæ˜¯ä½ åœ¨æœ¬åœ°æˆ–è€…ä½¿ç”¨ <a href="https://docs.gitlab.com/runner/" target="_blank" rel="noopener">Docs Gitlab Com Runner</a> (æ¨èä½¿ç”¨ï¼Œå…·ä½“æ“ä½œè‡ªè¡ŒæŸ¥é˜…æ–‡æ¡£)</p>
<p>æ„å»ºåæŠŠæ‰€éœ€è¦çš„èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåˆ—ä¸€ä¸‹æ‰€éœ€è¦çš„ç›®å½•æ¸…å•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">â”œâ”€ .next // required</span><br><span class="line">â”œâ”€ pages // just empty dir, <span class="keyword">for</span> safe</span><br><span class="line">â”œâ”€ next.config.js // <span class="keyword">if</span> have</span><br><span class="line">â”œâ”€ server.js // <span class="keyword">if</span> have</span><br><span class="line">â”œâ”€ static // <span class="keyword">if</span> have</span><br><span class="line">â”œâ”€ config // Mentioned above, <span class="keyword">if</span> have</span><br><span class="line">â”œâ”€ package.json // required</span><br><span class="line">â”œâ”€ package-lock.json // optional</span><br><span class="line">â””â”€ yarn.lock // optional</span><br></pre></td></tr></table></figure>

<ul>
<li><code>.next</code>ï¼š<code>next build</code>æ‰§è¡Œåç¼–è¯‘å®Œæˆçš„æ–‡ä»¶ç›®å½•</li>
<li><code>pages</code>ï¼šå»ºè®®ä¼ ä¸€ä¸ªç©ºç›®å½•ã€‚æŒ‰ç†æ¥è¯´ä¸éœ€è¦ï¼Œå› ä¸ºé‡Œé¢çš„æºæ–‡ä»¶å·²ç»è¢«æ‰“åŒ…åˆ°<em>.next</em>ç›®å½•å»äº†ï¼Œä½†ç”±äºæœ€è¿‘åœ¨éƒ¨ç½²çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªæŠ¥é”™æç¤ºè¯´æ‰¾ä¸åˆ°pagesï¼Œå¼„äº†ä¸€ä¸ªç©ºç›®å½•å°±æ­£å¸¸è¿è¡Œäº†ã€‚emmâ€¦æ™šç‚¹å»æä¸ªissue</li>
<li><code>next.config.js</code>ï¼šå¦‚æœä½ æœ‰å®šåˆ¶åŒ–é…ç½®çš„è¯</li>
<li><code>server.js</code>ï¼šå¦‚æœä½ æœ‰å®šåˆ¶åŒ–nodeæœåŠ¡çš„è¯</li>
<li><code>static</code>: é™æ€èµ„æºç›®å½•ï¼Œç”±è‡ªå·±åˆ›å»ºï¼ŒNext.jsç¼–è¯‘ä¼šå¿½ç•¥è¿™ä¸ªç›®å½•ï¼Œå¦‚æœä½ appæœ‰å¼•ç”¨è¿™ä¸ªç›®å½•çš„é™æ€èµ„æºï¼Œéœ€è¦å¸¦ä¸Š</li>
<li><code>config</code>ï¼šå‰æ–‡æåˆ°çš„ï¼Œå¦‚æœä½ æŒ‰ç…§æœ¬æ–‡åšçš„ç¯å¢ƒåˆ†å‰²çš„è¯</li>
<li><code>package.json</code>ï¼šåœ¨æœåŠ¡å™¨éœ€è¦Next.jsç­‰çš„npmæ¨¡å—æ¥å¯åŠ¨æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªæ–‡ä»¶æ¥å®‰è£…ä¾èµ–</li>
<li><code>package-lock.json</code>ï¼šä¸è§£é‡Šäº†</li>
<li><code>yarn.lock</code>ï¼šä¸è§£é‡Šäº†</li>
</ul>
<p>å®Œæˆä¼ è¾“åï¼Œè¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn</span><br><span class="line">// or</span><br><span class="line">npm install</span><br><span class="line">// no build <span class="built_in">command</span> needed</span><br><span class="line">DEPLOY_ENV=<span class="variable">$YOUR_SERVER_ENV_TYPE</span> next start</span><br></pre></td></tr></table></figure>

<h2 id="éƒ¨ç½²è·¯å¾„"><a href="#éƒ¨ç½²è·¯å¾„" class="headerlink" title="éƒ¨ç½²è·¯å¾„"></a>éƒ¨ç½²è·¯å¾„</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒNext.jsé»˜è®¤æ˜¯é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯ç”±çš„ï¼ˆ<em>file-system routing*ï¼‰ã€‚å‡è®¾ä½ é¡¹ç›®éƒ¨ç½²çš„åŸŸåæ˜¯ <a href="http://www.myapp.com" target="_blank" rel="noopener">www.myapp.com</a> ï¼Œä½ è¦è®¿é—®</em>/pages<em>ç›®å½•ä¸‹çš„</em>home.tsx*ï¼Œåˆ™è®¿é—®çš„urlä¸º <a href="http://www.myapp.com/home" target="_blank" rel="noopener">http://www.myapp.com/home</a> ï¼Œé€šå¸¸è¿™æ ·æ˜¯èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„ä¸šåŠ¡åœºæ™¯çš„ï¼Œè¿™ä¸€ç« æˆ‘æƒ³è¦è®²çš„ï¼Œå°±æ˜¯æ¯”è¾ƒå¯èƒ½å‡ºç°çš„å¦å¤–ä¸€ç§ä¸šåŠ¡åœºæ™¯ï¼Œå³å•ä¸ªåŸŸåä¸‹éƒ¨ç½²å¤šä¸ªé¡¹ç›®ï¼Œä¸ä»…ä»…æ˜¯Next.jsé¡¹ç›®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯Vueã€Reactã€Angularã€JQueryç­‰å…¶ä»–ç±»å‹çš„webé¡¹ç›®</p>
<p>â€¦â€¦</p>
<p>åŸæ–‡é“¾æ¥æŒç»­æ›´æ–°ï¼š<a href="https://echo-lynn.github.io/Programming/JavaScript/Next.js%20with%20TypeScript%20and%20Mobx/" target="_blank" rel="noopener"><strong>Echo Lynnâ€™s Blog</strong></a></p>
]]></content>
      <categories>
        <category>Programming</category>
        <category>JavaScript</category>
      </categories>
  </entry>
</search>
